@model Arcade.ViewModels.ProductDetailViewModel

@{
    ViewData["Title"] = Model.Product.ProductName;
}

<style>
    /* Product Details Enhanced Styles */
    .product-details-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }

    .product-breadcrumb {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }

    .product-breadcrumb a {
        color: var(--arcade-text-muted);
        text-decoration: none;
        transition: color 0.3s ease;
        font-size: 0.9rem;
    }

    .product-breadcrumb a:hover {
        color: var(--arcade-primary);
    }

    .product-breadcrumb-sep {
        color: var(--arcade-text-muted);
        opacity: 0.5;
    }

    .product-breadcrumb-current {
        color: var(--arcade-text);
        font-weight: 500;
        font-size: 0.9rem;
    }

    .product-main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 3rem;
        margin-bottom: 3rem;
    }

    /* Image Gallery */
    .product-gallery {
        background: var(--arcade-surface);
        border: 1px solid var(--arcade-border);
        border-radius: 16px;
        padding: 2rem;
        position: sticky;
        top: 120px;
    }

    .product-image-main {
        position: relative;
        width: 100%;
        height: 500px;
        border-radius: 12px;
        overflow: hidden;
        background: var(--arcade-bg);
        margin-bottom: 1rem;
        cursor: zoom-in;
        transition: all 0.3s ease;
    }

    .product-image-main:hover {
        transform: scale(1.02);
    }

    .product-image-main img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .product-zoom-icon {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(10px);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ffffff;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .product-image-main:hover .product-zoom-icon {
        opacity: 1;
    }

    /* Product Info */
    .product-info-section {
        background: var(--arcade-surface);
        border: 1px solid var(--arcade-border);
        border-radius: 16px;
        padding: 2rem;
    }

    .product-category-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(124, 58, 237, 0.1);
        border: 1px solid rgba(124, 58, 237, 0.3);
        border-radius: 20px;
        color: var(--arcade-primary);
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 1rem;
    }

    .product-title {
        font-family: 'Poppins', sans-serif;
        font-size: 2rem;
        font-weight: 700;
        color: var(--arcade-text);
        margin-bottom: 1.5rem;
        line-height: 1.3;
    }

    .product-price-section {
        background: var(--arcade-bg-alt);
        border: 1px solid var(--arcade-border);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .product-price-large {
        font-family: 'Poppins', sans-serif;
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--arcade-primary), var(--arcade-accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
    }

    .product-stock-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .product-stock-badge.in-stock {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        color: var(--arcade-success);
    }

    .product-stock-badge.out-of-stock {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: var(--arcade-danger);
    }

    .product-description {
        color: var(--arcade-text-muted);
        line-height: 1.8;
        margin: 1.5rem 0;
        font-size: 1rem;
    }

    /* Quantity Control */
    .product-actions {
        margin-top: 2rem;
    }

    .quantity-selector {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .quantity-label {
        font-weight: 600;
        color: var(--arcade-text);
        font-size: 0.95rem;
    }

    .quantity-controls {
        display: flex;
        align-items: center;
        background: var(--arcade-bg);
        border: 1px solid var(--arcade-border);
        border-radius: 8px;
        overflow: hidden;
    }

    .quantity-btn {
        width: 40px;
        height: 40px;
        background: transparent;
        border: none;
        color: var(--arcade-text);
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .quantity-btn:hover {
        background: var(--arcade-primary);
        color: #000000;
    }

    .quantity-input {
        width: 60px;
        height: 40px;
        border: none;
        background: transparent;
        text-align: center;
        font-weight: 600;
        color: var(--arcade-text);
        font-size: 1rem;
    }

    .quantity-input:focus {
        outline: none;
    }

    .add-to-cart-btn {
        width: 100%;
        padding: 1rem 2rem;
        background: linear-gradient(135deg, var(--arcade-primary), var(--arcade-accent)) !important;
        color: #000000 !important;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .add-to-cart-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 32px rgba(124, 58, 237, 0.4);
    }

    /* Features */
    .product-features {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid var(--arcade-border);
    }

    .product-feature {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: var(--arcade-bg-alt);
        border: 1px solid var(--arcade-border);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .product-feature:hover {
        border-color: var(--arcade-primary);
        transform: translateX(5px);
    }

    .product-feature-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, var(--arcade-primary), var(--arcade-accent));
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #000000;
        font-size: 1.25rem;
        flex-shrink: 0;
    }

    .product-feature-text {
        color: var(--arcade-text);
        font-weight: 500;
        font-size: 0.95rem;
    }

    /* Tabs */
    .product-tabs-section {
        background: var(--arcade-surface);
        border: 1px solid var(--arcade-border);
        border-radius: 16px;
        overflow: hidden;
        margin-bottom: 3rem;
    }

    .product-tabs {
        display: flex;
        gap: 0;
        background: var(--arcade-bg-alt);
        border-bottom: 1px solid var(--arcade-border);
    }

    .product-tab {
        flex: 1;
        padding: 1.25rem 2rem;
        background: transparent;
        border: none;
        color: var(--arcade-text-muted);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }

    .product-tab:hover {
        color: var(--arcade-text);
        background: var(--arcade-bg);
    }

    .product-tab.active {
        color: var(--arcade-primary);
        background: var(--arcade-surface);
    }

    .product-tab.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--arcade-primary), var(--arcade-accent));
    }

    .product-tab-content {
        padding: 2rem;
    }

    .product-tab-pane {
        display: none;
    }

    .product-tab-pane.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .specs-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 0.5rem;
    }

    .specs-table tr {
        background: var(--arcade-bg-alt);
    }

    .specs-table td {
        padding: 1rem 1.5rem;
        color: var(--arcade-text);
    }

    .specs-table td:first-child {
        font-weight: 600;
        color: var(--arcade-text-muted);
        width: 200px;
    }

    /* Related Products */
    .related-section {
        margin-top: 4rem;
    }

    .related-title {
        font-family: 'Poppins', sans-serif;
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--arcade-text);
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .related-title i {
        color: var(--arcade-primary);
    }

    /* Responsive */
    @@media (max-width: 992px) {
        .product-main-grid {
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .product-gallery {
            position: static;
        }

        .product-title {
            font-size: 1.5rem;
        }

        .product-price-large {
            font-size: 2rem;
        }

        .product-tabs {
            overflow-x: auto;
        }

        .product-tab {
            padding: 1rem 1.5rem;
            white-space: nowrap;
        }
    }
</style>

<div class="product-details-container">
    <!-- Breadcrumb -->
    <nav class="product-breadcrumb">
        <a asp-controller="Home" asp-action="Index"><i class="fas fa-home"></i> Home</a>
        <span class="product-breadcrumb-sep">/</span>
        <a asp-controller="Product" asp-action="Index">Products</a>
        <span class="product-breadcrumb-sep">/</span>
        <a asp-controller="Product" asp-action="Index"
            asp-route-category="@Model.Product.Category?.CategoryName">@Model.Product.Category?.CategoryName</a>
        <span class="product-breadcrumb-sep">/</span>
        <span class="product-breadcrumb-current">@Model.Product.ProductName</span>
    </nav>

    <!-- Main Product Section -->
    <div class="product-main-grid">
        <!-- Image Gallery -->
        <div class="product-gallery">
            <div class="product-image-main" data-bs-toggle="modal" data-bs-target="#imageModal">
                <img src="@(Model.Product.ImageUrl ?? "/images/placeholder.svg")" alt="@Model.Product.ProductName"
                    id="currentImage" onerror="this.onerror=null; this.src='/images/placeholder.svg';">
                <div class="product-zoom-icon">
                    <i class="fas fa-search-plus"></i>
                </div>
            </div>
        </div>

        <!-- Product Info -->
        <div class="product-info-section">
            <span class="product-category-badge">
                <i class="fas fa-tag"></i>
                @Model.Product.Category?.CategoryName
            </span>

            <h1 class="product-title">@Model.Product.ProductName</h1>

            @if (!string.IsNullOrEmpty(Model.Product.ShortDescription))
            {
                <p
                    style="color: var(--arcade-text-muted); font-size: 1.1rem; margin: 0.75rem 0 1.5rem 0; font-weight: 500;">
                    @Model.Product.ShortDescription</p>
            }

            <div class="product-price-section">
                <div class="product-price-large">EGP @Model.Product.Price.ToString("N0")</div>
                <span class="product-stock-badge @(Model.Product.StockQuantity > 0 ? "in-stock" : "out-of-stock")">
                    <i class="fas @(Model.Product.StockQuantity > 0 ? "fa-check-circle" : "fa-times-circle")"></i>
                    @if (Model.Product.StockQuantity > 0)
                    {
                        <span>In Stock (@Model.Product.StockQuantity available)</span>
                    }
                    else
                    {
                        <span>Out of Stock</span>
                    }
                </span>
            </div>

            <p class="product-description">@Model.Product.Description</p>

            @if (Model.Product.StockQuantity > 0)
            {
                <form asp-controller="Cart" asp-action="Add" method="post" class="product-actions">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="productId" value="@Model.Product.ProductId" />

                    <div class="quantity-selector">
                        <span class="quantity-label">Quantity:</span>
                        <div class="quantity-controls">
                            <button type="button" class="quantity-btn" onclick="decrementQty()">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" name="quantity" id="quantity" value="1" min="1"
                                max="@Model.Product.StockQuantity" class="quantity-input" readonly />
                            <button type="button" class="quantity-btn" onclick="incrementQty(@Model.Product.StockQuantity)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <button type="submit" class="add-to-cart-btn">
                        <i class="fas fa-shopping-cart"></i>
                        Add to Cart
                    </button>
                </form>
            }

            <div class="product-features">
                <div class="product-feature">
                    <div class="product-feature-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <span class="product-feature-text">Free shipping on orders over $50</span>
                </div>
                <div class="product-feature">
                    <div class="product-feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <span class="product-feature-text">2-year warranty included</span>
                </div>
                <div class="product-feature">
                    <div class="product-feature-icon">
                        <i class="fas fa-undo"></i>
                    </div>
                    <span class="product-feature-text">30-day return policy</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs Section -->
    <div class="product-tabs-section">
        <div class="product-tabs">
            <button class="product-tab active" data-tab="description">
                <i class="fas fa-info-circle"></i> Description
            </button>
            <button class="product-tab" data-tab="specifications">
                <i class="fas fa-list-alt"></i> Specifications
            </button>
        </div>
        <div class="product-tab-content">
            <div class="product-tab-pane active" id="description">
                <p style="color: var(--arcade-text); line-height: 1.8; font-size: 1rem;">@Model.Product.Description</p>
            </div>
            <div class="product-tab-pane" id="specifications">
                <table class="specs-table">
                    <tbody>
                        <tr>
                            <td><i class="fas fa-tag" style="color: var(--arcade-primary); margin-right: 0.5rem;"></i>
                                Category</td>
                            <td>@Model.Product.Category?.CategoryName</td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-building"
                                    style="color: var(--arcade-primary); margin-right: 0.5rem;"></i> Brand</td>
                            <td>@(Model.Product.Brand ?? "N/A")</td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-barcode"
                                    style="color: var(--arcade-primary); margin-right: 0.5rem;"></i> SKU</td>
                            <td>@(Model.Product.SKU ?? $"ARC-{Model.Product.ProductId:D6}")</td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-box" style="color: var(--arcade-primary); margin-right: 0.5rem;"></i>
                                Stock Quantity</td>
                            <td>@Model.Product.StockQuantity units</td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-dollar-sign"
                                    style="color: var(--arcade-primary); margin-right: 0.5rem;"></i> Price</td>
                            <td><strong style="color: var(--arcade-primary);">EGP
                                    @Model.Product.Price.ToString("N0")</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    @if (Model.RelatedProducts != null && Model.RelatedProducts.Any())
    {
        <section class="related-section">
            <h2 class="related-title">
                <i class="fas fa-th-large"></i>
                You May Also Like
            </h2>
            <div class="cyber-product-grid">
                @foreach (var product in Model.RelatedProducts.Take(4))
                {
                    <div class="cyber-product-card fade-in">
                        <div class="cyber-product-image">
                            <img src="@(product.ImageUrl ?? "/images/placeholder.svg")" alt="@product.ProductName"
                                onerror="this.onerror=null; this.src='/images/placeholder.svg';">
                            <div class="cyber-product-overlay">
                                <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductId"
                                    class="cyber-btn cyber-btn-primary">
                                    <i class="fas fa-eye"></i> View Details
                                </a>
                            </div>
                        </div>
                        <div class="cyber-product-body">
                            <span class="cyber-product-category">@product.Category?.CategoryName</span>
                            <h3 class="cyber-product-name">@product.ProductName</h3>
                            <div class="cyber-product-price">EGP @product.Price.ToString("N0")</div>
                        </div>
                    </div>
                }
            </div>
        </section>
    }
</div>

<!-- Image Modal -->
<div class="modal fade" id="imageModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content cyber-modal">
            <button type="button" class="cyber-modal-close" data-bs-dismiss="modal">
                <i class="fas fa-times"></i>
            </button>
            <div class="cyber-modal-body">
                <img src="@(Model.Product.ImageUrl ?? "/images/placeholder.svg")" alt="@Model.Product.ProductName"
                    id="modalImage" onerror="this.onerror=null; this.src='/images/placeholder.svg';">
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Quantity Controls
        function incrementQty(max) {
            const input = document.getElementById('quantity');
            const currentValue = parseInt(input.value);
            if (currentValue < max) {
                input.value = currentValue + 1;
            }
        }

        function decrementQty() {
            const input = document.getElementById('quantity');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
            }
        }

        // Tab switching with smooth animation
        document.querySelectorAll('.product-tab').forEach(tab => {
            tab.addEventListener('click', function () {
                const target = this.dataset.tab;

                // Remove active class from all tabs and panes
                document.querySelectorAll('.product-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.product-tab-pane').forEach(p => p.classList.remove('active'));

                // Add active class to clicked tab and corresponding pane
                this.classList.add('active');
                document.getElementById(target).classList.add('active');
            });
        });

        // Add to cart form submission handler
        const addToCartForm = document.querySelector('.product-actions');
        if (addToCartForm) {
            addToCartForm.addEventListener('submit', function (e) {
                const btn = this.querySelector('.add-to-cart-btn');
                if (btn) {
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
                    btn.disabled = true;
                }
            });
        }

        // Image zoom on hover effect
        const mainImage = document.querySelector('.product-image-main img');
        if (mainImage) {
            mainImage.addEventListener('mousemove', function (e) {
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const xPercent = (x / rect.width) * 100;
                const yPercent = (y / rect.height) * 100;

                this.style.transformOrigin = `${xPercent}% ${yPercent}%`;
            });

            mainImage.addEventListener('mouseenter', function () {
                this.style.transform = 'scale(1.5)';
                this.style.transition = 'transform 0.3s ease';
            });

            mainImage.addEventListener('mouseleave', function () {
                this.style.transform = 'scale(1)';
            });
        }

        // Smooth scroll for breadcrumb
        document.querySelectorAll('.product-breadcrumb a').forEach(link => {
            link.addEventListener('click', function (e) {
                if (this.getAttribute('href') === '#') {
                    e.preventDefault();
                }
            });
        });
    </script>
}