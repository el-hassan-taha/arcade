@model Arcade.ViewModels.ChangePasswordViewModel
@{
    ViewData["Title"] = "Change Password";
}

<div class="cyber-page-header">
    <h1 class="cyber-page-title">
        <i class="fas fa-key"></i> Change Password
    </h1>
    <p class="cyber-page-subtitle">Update your account security</p>
</div>

<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="cyber-card">
            <div class="cyber-card-header">
                <h3 class="cyber-card-title">
                    <i class="fas fa-shield-alt"></i> Security Settings
                </h3>
            </div>
            <div class="cyber-card-body">
                <div class="cyber-security-notice">
                    <i class="fas fa-info-circle"></i>
                    <p>For your security, please enter your current password and choose a strong new password.</p>
                </div>

                <form asp-action="ChangePassword" method="post" class="cyber-form">
                    <div asp-validation-summary="ModelOnly" class="cyber-alert cyber-alert-danger"></div>

                    <div class="cyber-form-group">
                        <label asp-for="CurrentPassword" class="cyber-label">
                            <i class="fas fa-lock"></i> Current Password
                        </label>
                        <div class="cyber-input-group">
                            <input asp-for="CurrentPassword" class="cyber-input"
                                placeholder="Enter your current password" />
                            <button type="button" class="cyber-input-addon toggle-password" tabindex="-1">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span asp-validation-for="CurrentPassword" class="cyber-validation-error"></span>
                    </div>

                    <div class="cyber-form-group">
                        <label asp-for="NewPassword" class="cyber-label">
                            <i class="fas fa-lock"></i> New Password
                        </label>
                        <div class="cyber-input-group">
                            <input asp-for="NewPassword" class="cyber-input" placeholder="Enter new password" />
                            <button type="button" class="cyber-input-addon toggle-password" tabindex="-1">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span asp-validation-for="NewPassword" class="cyber-validation-error"></span>
                        <div class="cyber-password-requirements">
                            <p class="cyber-form-hint">Password must contain:</p>
                            <ul>
                                <li id="req-length"><i class="fas fa-circle"></i> At least 6 characters</li>
                                <li id="req-upper"><i class="fas fa-circle"></i> One uppercase letter</li>
                                <li id="req-lower"><i class="fas fa-circle"></i> One lowercase letter</li>
                                <li id="req-number"><i class="fas fa-circle"></i> One number</li>
                            </ul>
                        </div>
                    </div>

                    <div class="cyber-form-group">
                        <label asp-for="ConfirmPassword" class="cyber-label">
                            <i class="fas fa-lock"></i> Confirm New Password
                        </label>
                        <div class="cyber-input-group">
                            <input asp-for="ConfirmPassword" class="cyber-input" placeholder="Confirm new password" />
                            <button type="button" class="cyber-input-addon toggle-password" tabindex="-1">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span asp-validation-for="ConfirmPassword" class="cyber-validation-error"></span>
                    </div>

                    <div class="cyber-form-actions">
                        <button type="submit" class="cyber-btn cyber-btn-primary">
                            <i class="fas fa-check"></i> Update Password
                        </button>
                        <a asp-action="Profile" class="cyber-btn cyber-btn-ghost">
                            <i class="fas fa-arrow-left"></i> Back to Profile
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Toggle password visibility
        document.querySelectorAll('.toggle-password').forEach(button => {
            button.addEventListener('click', function () {
                const input = this.previousElementSibling;
                const icon = this.querySelector('i');
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        });

        // Password requirements validation
        const newPassword = document.getElementById('NewPassword');
        if (newPassword) {
            newPassword.addEventListener('input', function () {
                const val = this.value;
                toggleReq('req-length', val.length >= 6);
                toggleReq('req-upper', /[A-Z]/.test(val));
                toggleReq('req-lower', /[a-z]/.test(val));
                toggleReq('req-number', /[0-9]/.test(val));
            });
        }

        function toggleReq(id, valid) {
            const el = document.getElementById(id);
            if (el) {
                el.classList.toggle('valid', valid);
                const icon = el.querySelector('i');
                icon.classList.toggle('fa-circle', !valid);
                icon.classList.toggle('fa-check-circle', valid);
            }
        }
    </script>
}
